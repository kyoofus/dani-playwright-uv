# 네이버 부동산 크롤러 사용 가이드

## 프로젝트 개요

이 프로젝트는 Playwright MCP(Model Context Protocol)를 사용하여 네이버 부동산 사이트에서 부동산 정보를 크롤링하는 Python 프로그램입니다.

## 주요 기능

### 1. 부동산 단지 정보 수집
- 지정된 지역의 아파트, 분양권, 재건축 등의 기본 정보
- 가격 범위, 세대수, 완공년도 등의 상세 데이터

### 2. 개발계획 정보 수집 
- 도로 개발계획
- 철도 개발계획  
- 지구단위 개발계획

### 3. 데이터 저장
- JSON 형태로 원본 데이터 저장
- Excel 형태로 분석 가능한 데이터 저장

## 설치 및 실행

### 1. 패키지 설치
```bash
uv add aiohttp playwright pandas openpyxl
uv run playwright install
```

### 2. 기본 실행
```bash
uv run python run_default.py
```

### 3. 사용자 지정 실행
```bash
uv run python main.py
```

## 수집되는 API 및 데이터

### 1. 단지 마커 정보 API
**엔드포인트**: `/api/complexes/single-markers/2.0`

**수집 데이터**:
- `markerId`: 단지 고유 ID
- `complexName`: 단지명
- `realEstateTypeName`: 부동산 타입 (아파트, 분양권 등)
- `latitude`, `longitude`: 위치 좌표
- `completionYearMonth`: 완공년월
- `totalHouseholdCount`: 총 세대수
- `minDealPrice`, `maxDealPrice`: 매매가격 범위
- `minLeasePrice`, `maxLeasePrice`: 전세가격 범위
- `dealCount`, `leaseCount`: 거래 건수

### 2. 개발계획 정보 API
**엔드포인트**: 
- `/api/developmentplan/road/list` (도로)
- `/api/developmentplan/rail/list` (철도)  
- `/api/developmentplan/jigu/list` (지구개발)

**수집 데이터**:
- 해당 지역의 미래 개발계획 정보
- 교통 인프라 개선 계획
- 지구단위 계획구역 정보

### 3. 단지 상세 정보 API (선택적)
**엔드포인트**: `/api/complexes/detail/{complexNo}`

**수집 데이터**:
- 단지의 상세한 시설 정보
- 주변 편의시설 정보
- 교통 접근성 정보

### 4. 매물 정보 API (선택적)  
**엔드포인트**: `/api/articles/complex/{complexNo}`

**수집 데이터**:
- 실제 매물 리스트
- 층별, 면적별 가격 정보
- 매물 등록일 및 특징

## 출력 파일 형태

### JSON 파일 구조
```json
{
  "area_info": {
    "center_lat": 37.3642443,
    "center_lon": 127.1084674,
    "bounds": { "left_lon": 127.098..., ... }
  },
  "complexes": [
    {
      "markerId": "114261",
      "complexName": "피더하우스(실버주택)",
      "realEstateTypeName": "아파트",
      "minDealPrice": 40000,
      "maxDealPrice": 40000,
      ...
    }
  ],
  "complex_details": { ... },
  "articles": { ... },
  "development_plans": {
    "road": [ ... ],
    "rail": [ ... ],
    "jigu": [ ... ]
  }
}
```

### Excel 파일 구조
- **단지정보** 시트: 수집된 모든 단지의 기본 정보
- **매물정보** 시트: 단지별 매물 상세 정보
- **road_개발계획** 시트: 도로 개발계획 정보
- **rail_개발계획** 시트: 철도 개발계획 정보  
- **jigu_개발계획** 시트: 지구개발계획 정보

## API 동작 원리

1. **세션 초기화**: 
   - Playwright로 브라우저 실행
   - 네이버 부동산 사이트 방문하여 쿠키 및 세션 설정
   - 실제 브라우저 환경에서 User-Agent와 헤더 정보 수집

2. **API 호출**:
   - 수집된 쿠키와 헤더를 사용하여 aiohttp 세션 생성
   - 네이버 부동산의 내부 API 엔드포인트 호출
   - JSON 형태의 응답 데이터 파싱

3. **데이터 처리**:
   - 좌표 범위 기반으로 지역별 단지 정보 수집
   - 각 단지의 상세 정보 및 매물 정보 추가 수집
   - 개발계획 정보를 통한 미래 가치 분석 데이터 제공

## 수집 결과 예시

```
=== 크롤링 결과 요약 ===
수집된 단지 수: 27
상세 정보 수집된 단지 수: 0
수집된 매물 수: 0
road 개발계획 수: 0
rail 개발계획 수: 0  
jigu 개발계획 수: 0

=== 단지 정보 미리보기 (상위 3개) ===
1. 피더하우스(실버주택)
   타입: 아파트
   완공년월: 200502
   세대수: 161
   매매가격: 40,000만원 ~ 40,000만원

2. 느티마을경남,선경  
   타입: 아파트
   완공년월: 199509
   세대수: 200
   매매가격: 0만원 ~ 0만원

3. 느티마을공무원4단지
   타입: 아파트
   완공년월: 199411
   세대수: 1006
   매매가격: 152,000만원 ~ 215,000만원
```

## 주의사항

1. **법적 준수**: 네이버의 이용약관과 robots.txt를 반드시 확인하고 준수하세요.

2. **요청 제한**: 과도한 요청으로 인한 IP 차단을 방지하기 위해 적절한 딜레이를 설정했습니다.

3. **데이터 정확성**: API 응답 데이터는 실시간으로 변경될 수 있으므로 수집 시점을 고려하세요.

4. **사용 목적**: 이 프로그램은 교육 및 연구 목적으로만 사용해야 합니다.

## 문제해결

### 빈 결과가 나오는 경우
- 좌표 범위가 너무 작을 수 있습니다. `radius` 값을 0.01 이상으로 늘려보세요.
- 해당 지역에 실제로 부동산이 없을 수 있습니다.

### 404/401 오류가 발생하는 경우  
- 상세 정보나 매물 정보 API는 추가 인증이 필요할 수 있습니다.
- 기본 단지 정보는 정상적으로 수집되므로 분석에 활용할 수 있습니다.

### 브라우저 관련 오류
- `uv run playwright install`로 브라우저를 다시 설치해보세요.
- Windows에서 권한 문제가 있을 경우 관리자 권한으로 실행하세요.

이 프로그램을 통해 네이버 부동산의 다양한 API를 이해하고 부동산 데이터 분석에 활용할 수 있습니다.
